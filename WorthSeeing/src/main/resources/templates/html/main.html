<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:replace="/fragments/header :: head">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
	<style>
.blockTest {
	position: relative;
	z-index: 1;
}

.tt {
	border: 1px solid gray;
	position: absolute;
	width: 100px;
	height: 100px;
	background-color: #F3F3F3;
}

.tt img {
	width: 100%;
	height: 100%;
	z-index: 3;
}

.topnav {
	overflow: hidden;
	background-color: #333;
}

.topnav div {
	float: left;
	display: block;
	color: #f2f2f2;
	text-align: center;
	padding: 14px 16px;
	margin-left: 13%;
	text-decoration: none;
}

.numberDisplay {
	display: none;
	border-radius: 50%;
	background: #7AB730;
	color: white;
	text-align: center;
	font-weight: bold;
	font-size: 24px;
	width: 50px;
	height: 50px;
	margin-left: 25px;
	margin-top: 20px;
	padding: 8px 0;
}

.numberDisplay {
	border-radius: 50%;
}

.reservationBtn, .betweenDay {
	border: 1px solid #7AB730;
	background-color: rgba(0, 0, 0, 0);
	color: #7AB730;
	padding: 5px;
	font-size: 30px;
	display: none;
	text-align: center;
}

.reservationBtn:hover {
	color: white;
	background-color: #7AB730;
}
</style>

	<script>
	
	// 인기순위 Top 5 이미지 띄우기
	function top5Img() {
		var cImgTopList = encodeURI("[[${listTopcImg}]]");
		var cImgTopArr = cImgTopList.split(",");
	       
		for (var i = 1; i <= 5; i++) {
			$("#topImg" + i).attr("src", cImgTopArr[i].slice(3));
			if (i == 5) {
				$("#topImg" + i).attr("src", cImgTopArr[i].slice(3).slice(0, -3));
			}
		}
	}
	
	// 289개 블록 띄우기
	function createBlock(listBGSeq) {
		var cImgList = encodeURI("[[${listcImg}]]");
	    var cImgArr = cImgList.split(",");
	    var topSize = 0;
	    var betweenDaysList = [[${betweenDaysList}]]
	    var betweenDaysArr = Array.from(betweenDaysList);
	    
		for (var i = 1; i <= 289; i++) {
			var child = "<div class='tt' id=" + i + "><p class='numberDisplay'>" + i + "</p><p class='betweenDay'>" + betweenDaysArr[i] + " 일 남음</p><button class='reservationBtn'>예약 하기</button><img class='imgDisplay' src='"+ cImgArr[i].slice(3) + "'/></li>";
	          
			$(".blockTest").append(child);

			if (i % 17 == 0) {
				// 	$("#" + i).css('margin-left', 100 * i + 'px');
				$("#" + i).css('margin-top', topSize + 'px');
				topSize += 100;
			} else {
				$("#" + i).css('margin-top', topSize + 'px');
			}
			
			if (i % 17 == 0) {
				$("#" + i).css('margin-left', 1700 + 'px');
			} else {
				$("#" + i).css('margin-left', 100 * (i % 17) + 'px');
			}
		}
	}
	
	
	// 오늘 기준으로 이전 날짜 데이터가 있으면 localStorage 리셋
	function resetLocalStorage() {
		var today = new Date();
		
		for (var i=0; i<sessionStorage.length; i++) {
			  var searchKey = sessionStorage.key(i);
			  const expireDate = JSON.parse(sessionStorage.getItem(searchKey)).expire;
			  
			  if (Number(today) > Number(expireDate)) {
				  window.sessionStorage.clear();
			}
		}
	}
	
	
	// localStorage에 클릭한 블록 저장하기
	function setLocalStorage(key, number, today, expireDate) {
		var random = Math.random();
		sessionStorage.setItem(key + random, JSON.stringify({ number: number, expire : expireDate })); // localStorage에 저장
		
		var setList = new Set();
		for (var i=0; i<sessionStorage.length; i++) {
			var searchKey = sessionStorage.key(i);
			  if (searchKey.slice(0, 3) == key) {
					setList.add(JSON.parse(sessionStorage.getItem(searchKey)).number.toString());
				}
			}
		console.log(setList.size)
		if (setList.size == 10) { // 클릭한 블록 개수가 중복 없이 10개가 되면 사용자 포인트 + 500
			// db에 사용자 포인트 + 500 저장, 포인트 지급 alert 창 띄움, 걸려있는 링크로 이동
			location.href="/updatePoint?blockGroup_seq=" + number;
		} else {
			// 걸려있는 링크로 이동
			location.href="/click?blockGroup_seq=" + number;
		}
	}
	
	
	/*
	function setLocalStorage(key, number, today, expireDate) {
		var random = Math.random();
		localStorage.setItem(key + random, JSON.stringify({ number: number, expire : expireDate })); // localStorage에 저장
		
		var setList = new Set();
		for (var i=0; i<localStorage.length; i++) {
			  var searchKey = localStorage.key(i);
			  const obj = JSON.parse(localStorage.getItem(searchKey)).expire;
			  
			  if(today > expireDate) {
				  window.localStorage.removeItem(searchKey);
				}
			  
			  if (searchKey.slice(0, 3) == key) {
						setList.add(JSON.parse(localStorage.getItem(searchKey)).number.toString());
				}
			  
			}
		
		if (setList.size == 10) { // 클릭한 블록 개수가 중복 없이 10개가 되면 사용자 포인트 + 500
			// db에 사용자 포인트 + 500 저장, 포인트 지급 alert 창 띄움, 걸려있는 링크로 이동
			location.href="/updatePoint?blockGroup_seq=" + number;
		}
		else {
			 // 걸려있는 링크로 이동
// 			location.href="/click?blockGroup_seq=" + number; 
		}
		
	}*/
	

	$(document).ready(function() {
		
		// 인기순위 Top 5 이미지 띄우기
		top5Img();
	       
		// 블록 289개 생성
		createBlock([[${blockGroupSeqList}]]);
       
		// 오늘 기준으로 이전 날짜 데이터가 있으면 localStorage 리셋
		resetLocalStorage();
		
		// 각 블록 클릭 시 localStorage에 저장 후 click 수 계산하여 처리
		var today = new Date();
		var expireDate = today.getFullYear() + (today.getMonth() + 1) + today.getDate() + 1;
		today = today.getFullYear() + (today.getMonth() + 1) + today.getDate();
		
		// 체크박스 이벤트
		$("#displayBlock").change(function() {
			if ($(this).is(':checked')) {
				$(".tt").click(function() {
					setLocalStorage($("#userName").text(), $(this).attr("id"), today, expireDate);
				});
				$(".numberDisplay").css("display", "none");
				$(".imgDisplay").css("display", "block");
				$(".reservationBtn").css("display", "none");
				$(".betweenDay").css("display", "none");
			} 
		})
		
		$("#displayBlockNum").change(function() {
			if ($(this).is(':checked')) {
				$(".numberDisplay").css("display", "block");
				$(".imgDisplay").css("display", "none");
				$(".reservationBtn").css("display", "none");
				$(".betweenDay").css("display", "none");
			} else {
				$(".numberDisplay").css("display", "none");
				$(".imgDisplay").css("display", "block");
				$(".reservationBtn").css("display", "none");
				$(".betweenDay").css("display", "none");
			}
		});
		
		// 남은 날짜 표시
		
		$("#displayBetweenDay").change(function() {
			if ($(this).is(':checked')) {
				$(".numberDisplay").css("display", "none");
				$(".imgDisplay").css("display", "none");
				$(".reservationBtn").css("display", "none");
				$(".betweenDay").css("display", "block");
			} else {
				$(".numberDisplay").css("display", "none");
				$(".imgDisplay").css("display", "block");
				$(".reservationBtn").css("display", "none");
				$(".betweenDay").css("display", "none");
			}
		});
       
		// 예약 가능 블록
		var reservationBlockGroupSeqList = [[${reservationBlockGroupSeqList}]]
		
		$("#availableReserv").change(function() {
			if ($(this).is(':checked')) {
				reservationBlockGroupSeqList.forEach(function(BlockGroupSeq) {
					$("#" + BlockGroupSeq).find("button").css("display", "block");
				})
				
				
// 				/reservation/reservationCredit?reservation_seq=
				
				$(".imgDisplay").css("display", "none");
				$(".betweenDay").css("display", "none");
				$(".numberDisplay").css("display", "none");
			} else {
				$(".reservationBtn").css("display", "none");
				$(".imgDisplay").css("display", "block");
				$(".numberDisplay").css("display", "none");
				$(".betweenDay").css("display", "none");
			}
		});
		
		
		
		
// 		$(".tt").append("<button class='reservationBtn'>예약 하기</button>");
		
		
       /*
				$("#12").css('z-index', '50');

				var xindex = parseInt($("#12").css('margin-left')); // 200
				var yindex = parseInt($("#12").css('margin-top')); // 30

				var changedxindex = xindex - 100; // 100
				var changedyindex = yindex; // 0

				$("#12").css('margin-left', changedxindex + 'px');
				$("#12").css('margin-top', changedyindex + 'px');
				$("#12").css('width', '300px');
				$("#12").css('height', '300px');
				$("#12").css('text-align', 'center');

				$("#11").css('z-index', '51');
				$("#13").css('z-index', '51');
				$("#45").css('z-index', '51');
				$("#47").css('z-index', '51');
		*/
		
		
		
		
		
		
	});
	
	
	</script>

	<th:block th:replace="/fragments/header :: TopbarFragment"></th:block>

	<!-- Carousel Start -->
	<div class="container-fluid p-0">
		<div id="header-carousel" class="carousel slide" data-ride="carousel">
			<div class="carousel-inner">
				<div class="carousel-item active">
					<img style="height: 700px;" id="topImg1" class="w-100"
						src="img/carousel-1.jpg" alt="Image">
					<div
						class="carousel-caption d-flex flex-column align-items-center justify-content-center">
						<div class="p-3" style="max-width: 900px;">
							<h1 class="display-3 text-white mb-md-4">Let's Discover The
								World Together</h1>
							<a href="" class="btn btn-primary py-md-3 px-md-5 mt-2" style="background-color: #7FA998; font-size: 18px;">L I N K</a>
						</div>
					</div>
				</div>
				<div class="carousel-item">
					<img style="height: 700px;" id="topImg2" class="w-100"
						src="img/carousel-2.jpg" alt="Image">
					<div
						class="carousel-caption d-flex flex-column align-items-center justify-content-center">
						<div class="p-3" style="max-width: 900px;">
							<h1 class="display-3 text-white mb-md-4">Discover Amazing
								Places With Us</h1>
							<a href="" class="btn btn-primary py-md-3 px-md-5 mt-2"style="font-size: 18px; background-color: #7FA998">L I N K</a>
						</div>
					</div>
				</div>
				<div class="carousel-item">
					<img style="height: 700px;" id="topImg3" class="w-100"
						src="img/carousel-2.jpg" alt="Image">
					<div
						class="carousel-caption d-flex flex-column align-items-center justify-content-center">
						<div class="p-3" style="max-width: 900px;">
							<h1 class="display-3 text-white mb-md-4">Discover Amazing
								Places With Us</h1>
							<a href="" class="btn btn-primary py-md-3 px-md-5 mt-2" style="font-size: 18px; background-color: #7FA998">L I N K</a>
						</div>
					</div>
				</div>
				<div class="carousel-item">
					<img style="height: 700px;" id="topImg4" class="w-100"
						src="img/carousel-2.jpg" alt="Image">
					<div
						class="carousel-caption d-flex flex-column align-items-center justify-content-center">
						<div class="p-3" style="max-width: 900px;">
							<h1 class="display-3 text-white mb-md-4">Discover Amazing
								Places With Us</h1>
							<a href="" class="btn btn-primary py-md-3 px-md-5 mt-2" style=" font-size: 18px; background-color: #7FA998">L I N K</a>
						</div>
					</div>
				</div>
				<div class="carousel-item">
					<img style="height: 700px;" id="topImg5" class="w-100"
						src="img/carousel-2.jpg" alt="Image">
					<div
						class="carousel-caption d-flex flex-column align-items-center justify-content-center">
						<div class="p-3" style="max-width: 900px;">
							<h1 class="display-3 text-white mb-md-4">Discover Amazing
								Places With Us</h1>
							<a href="" class="btn btn-primary py-md-3 px-md-5 mt-2" style="font-size: 18px; background-color: #7FA998">L I N K</a>
						</div>
					</div>
				</div>
			</div>
			<a class="carousel-control-prev" href="#header-carousel"
				data-slide="prev">
				<div class="btn btn-dark" style="width: 45px; height: 45px;">
					<span class="carousel-control-prev-icon mb-n2"></span>
				</div>
			</a> <a class="carousel-control-next" href="#header-carousel"
				data-slide="next">
				<div class="btn btn-dark" style="width: 45px; height: 45px;">
					<span class="carousel-control-next-icon mb-n2"></span>
				</div>
			</a>
		</div>
	</div>
	<!-- Carousel End -->

	<div>
		<div class="topnav">
			<div>
				<label> <input type="radio" name="checkbox" checked="checked"
					id="displayBlock" /> 기존 이미지 표시
				</label>
			</div>
			<div>
				<label> <input type="radio" name="checkbox"
					id="displayBlockNum" value="blockNumber" /> 블록 번호
				</label>
			</div>
			<div>
				<label> <input type="radio" name="checkbox"
					id="displayBetweenDay" value="leftTime" /> 남은 사용 시간
				</label>
			</div>
			<div>
				<label> <input type="radio" name="checkbox"
					id="availableReserv" value="reservAvailable" /> 예약 가능 블록
				</label>
			</div>
		</div>
	</div>


	<div>
		<div>
			<br /> <br /> <br />
			<div class="col-lg-4 col-md-6 mb-4 pb-2">


				<div class="blockTest"></div>






			</div>
			<!--     Blog End -->


			<!-- Footer Start -->
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
			<br /> <br />

			<div class="sec7-text-box">
				<div class="time font40">
					<span class="hours"></span> <span class="col">:</span> <span
						class="minutes"></span> <span class="col">:</span> <span
						class="seconds"></span>
				</div>

			</div>

		</div>
		<th:block th:replace="/fragments/footer :: footerFragment"></th:block>
	</div>
</body>

</html>